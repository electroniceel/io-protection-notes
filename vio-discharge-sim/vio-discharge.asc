Version 4
SHEET 1 1008 1764
WIRE -224 -272 -224 -304
WIRE -128 -272 -224 -272
WIRE -32 -272 -64 -272
WIRE 224 -272 48 -272
WIRE -224 -240 -224 -272
WIRE -224 -128 -224 -160
WIRE -1088 16 -1216 16
WIRE -608 16 -832 16
WIRE -480 16 -608 16
WIRE -336 16 -480 16
WIRE 224 16 224 -272
WIRE 224 16 -336 16
WIRE 576 16 224 16
WIRE 624 16 576 16
WIRE -608 48 -608 16
WIRE -1216 64 -1216 16
WIRE -480 96 -480 16
WIRE 320 96 256 96
WIRE -608 144 -608 112
WIRE 320 144 320 96
WIRE -1216 176 -1216 144
WIRE 576 176 576 16
WIRE -480 208 -480 176
WIRE -336 208 -336 16
WIRE -176 208 -336 208
WIRE 320 240 320 224
WIRE -336 272 -336 208
WIRE -176 272 -176 208
WIRE -960 288 -960 112
WIRE 16 304 -32 304
WIRE 576 304 576 256
WIRE 256 320 256 96
WIRE 224 336 112 336
WIRE 384 352 288 352
WIRE 400 352 384 352
WIRE 512 352 480 352
WIRE -336 368 -336 352
WIRE -176 368 -176 336
WIRE -176 368 -336 368
WIRE -32 368 -32 304
WIRE -32 368 -176 368
WIRE 224 368 -32 368
WIRE -960 400 -960 368
WIRE -336 400 -336 368
WIRE 256 416 256 384
WIRE 576 448 576 400
WIRE -336 512 -336 480
WIRE 112 512 112 336
WIRE 224 512 112 512
WIRE 384 512 384 352
WIRE 384 512 288 512
WIRE 400 512 384 512
WIRE 112 560 112 512
WIRE 112 560 48 560
WIRE 112 656 112 560
WIRE 208 656 112 656
WIRE 384 656 384 512
WIRE 384 656 288 656
WIRE -112 752 -336 752
WIRE 112 752 112 656
WIRE 112 752 -32 752
WIRE -464 784 -528 784
WIRE -464 832 -464 784
WIRE -464 928 -464 912
WIRE -480 1088 -688 1088
WIRE -336 1088 -336 752
WIRE -336 1088 -400 1088
WIRE -688 1168 -688 1088
WIRE -480 1168 -688 1168
WIRE -336 1168 -336 1088
WIRE -336 1168 -400 1168
WIRE -528 1296 -528 784
WIRE -928 1312 -1008 1312
WIRE -688 1312 -688 1168
WIRE -688 1312 -848 1312
WIRE -560 1312 -688 1312
WIRE -336 1328 -336 1168
WIRE -336 1328 -496 1328
WIRE -256 1328 -256 1280
WIRE -256 1328 -336 1328
WIRE -560 1344 -608 1344
WIRE -1008 1376 -1008 1312
WIRE -528 1392 -528 1360
WIRE -688 1408 -832 1408
WIRE -688 1456 -688 1408
WIRE -1008 1488 -1008 1456
WIRE -688 1584 -688 1536
WIRE -608 1584 -608 1344
WIRE -608 1584 -688 1584
WIRE -832 1616 -832 1408
WIRE -688 1632 -688 1584
WIRE -832 1728 -832 1696
WIRE -688 1744 -688 1712
FLAG 576 448 0
FLAG 256 416 0
FLAG 320 240 0
FLAG -336 512 0
FLAG -1216 176 0
FLAG 624 16 Vreg
FLAG -224 -128 0
FLAG -224 -304 Verr
FLAG 400 512 Op_out
FLAG -608 144 0
FLAG -480 208 0
FLAG 48 560 Op_in_inv
FLAG 16 304 Op_in_non
FLAG -960 400 0
FLAG -528 1392 0
FLAG -464 928 0
FLAG -1008 1488 0
FLAG -832 1728 0
FLAG -256 1280 opctrl-out
FLAG -688 1744 0
SYMBOL npn 512 304 R0
SYMATTR InstName Q1
SYMATTR Value 2SCR512P
SYMBOL res 560 160 R0
SYMATTR InstName R1
SYMATTR Value 2.2R
SYMBOL res 496 336 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 47R
SYMBOL Opamps\\opamp2 256 288 R0
SYMATTR InstName U1
SYMATTR Value LM324
SYMATTR SpiceModel LM324
SYMBOL voltage 320 128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 5V
SYMBOL res -352 256 R0
SYMATTR InstName R3
SYMATTR Value 4.7K
SYMBOL res -352 384 R0
SYMATTR InstName R4
SYMATTR Value 4.7K
SYMBOL voltage -1216 48 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 8V
SYMBOL cap 288 496 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 1pf
SYMBOL voltage -224 -256 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value PULSE(0 {vset*2} 1ms 5µs 1ms 1µs 2ms)
SYMBOL schottky -128 -256 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value MBRS340
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res 64 -288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 2
SYMBOL res -16 736 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 1K
SYMBOL cap -624 48 R0
SYMATTR InstName C3
SYMATTR Value 47µF
SYMBOL PowerProducts\\LT1117 -960 16 R0
SYMATTR InstName U2
SYMBOL res -496 80 R0
SYMATTR InstName R10
SYMATTR Value 100R
SYMBOL cap -192 272 R0
SYMATTR InstName C4
SYMATTR Value 10nF
SYMBOL res 304 640 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 22k
SYMBOL voltage -960 272 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR InstName V5
SYMATTR Value {vset-1.25}
SYMBOL Opamps\\opamp2 -528 1264 R0
SYMATTR InstName U3
SYMATTR Value LM324
SYMATTR SpiceModel LM324
SYMBOL voltage -464 816 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value 5V
SYMBOL voltage -1008 1360 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value {vdac}
SYMBOL res -832 1296 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 4.7k
SYMBOL voltage -832 1600 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V8
SYMATTR Value 3.3
SYMBOL res -384 1152 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 6.8k
SYMBOL res -384 1072 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 5.1k
SYMBOL res -704 1440 R0
SYMATTR InstName R12
SYMATTR Value 4.3k
SYMBOL res -704 1616 R0
SYMATTR InstName R13
SYMATTR Value 5.1k
TEXT -1160 712 Left 2 !.tran 5ms startup
TEXT -1168 792 Left 2 !.include LM324.MOD
TEXT -144 -360 Left 2 ;Error injection
TEXT -1280 -136 Left 2 ;Regulator\n(just a standard model with easy to use adj input)
TEXT 648 296 Left 2 ;Discharge overvoltage
TEXT -544 248 Left 2 ;Regular load\n(lower limit)
TEXT -1128 560 Left 2 !.step param vset list 1.8 2.5 3.3 4 5
TEXT -1120 608 Left 2 !.param vdac=4.672-0.847*vset
TEXT -408 1464 Left 2 ;Voltage scaling\nfrom the DAC to half the set-voltage + 5%\nopout=2.897-0.62*Vdac
